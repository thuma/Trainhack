var statisticsIntervalId,myPlayer,bufferingInterval,protocol,chromeInterval,timeOutStreamError,accountBlockInterval,updateEventInterval,checkInterval=50,lastPlayPos=0,currentPlayPos=0,bufferingDetected=!1,secondsInBuffering=0,startedPlaying=!1,firstPlay=!1,errorRefreshTime=3e4,vodPosition=null,extended=!1,bookMarksArray=[],liveLabelClicked=!1,playerHandler={state:playerState.notInitialized,timeSpan:{start:0,end:0},captions:{},getCaptionsTrigger:void 0,pollCaptionsInterval:void 0,lastCaptionOnScreen:void 0,lastCaptionEndTime:void 0,getCaptionsFlag:!1,showCaption:!0,refreshDelay:500,showingCaptionsSetting:!1,displayCaption:function(){playerHandler.showCaption=!playerHandler.showCaption;var e=document.getElementById("caption-overlay"),t=document.getElementsByClassName("live-caption-button vjs-control")[0];playerHandler.showCaption?t.style="color: #21BAE8":playerHandler.showCaption?e.style="display: block; background-color: rgba(0, 0, 0, 0.55);":e.style="display: none; background-color: none;"},sortCaptions:function(e,t){return e.start>t.start?1:e.start<t.start?-1:0},addCaption:function(e){if(e&&e.start){var t=Math.floor(e.start);playerHandler.captions[t]||(playerHandler.captions[t]=e)}},findClosestStartTime:function(e){var t=[];for(var r in e){var n=e[r];n.start<=Math.floor(myPlayer.currentMediaTime())&&t.push(n)}return t[t.length-1]},pollCaptions:function(){player.debug&&console.log("debug: pollCaptions()");var e=document.getElementById("caption-overlay");e&&(myPlayer.isFullscreen()?e.className="maximized":e.className="minimized");var t=Math.floor(myPlayer.currentMediaTime()-4),r=playerHandler.captions[t],n=playerHandler.findClosestStartTime(playerHandler.captions);!r||playerHandler.lastCaptionOnScreen&&playerHandler.lastCaptionOnScreen==r.start?(playerHandler.lastCaptionOnScreen>t+30||playerHandler.lastCaptionOnScreen<t-30)&&((n=playerHandler.findClosestStartTime(playerHandler.captions))?display.createUpdateCaptionOverlay(n.text):display.createUpdateCaptionOverlay("")):(playerHandler.lastCaptionOnScreen=r.start,playerHandler.lastCaptionEndTime=r.end,display.createUpdateCaptionOverlay(r.text),r.shown=!0,playerHandler.captions[t]=r),t>playerHandler.lastCaptionEndTime&&display.createUpdateCaptionOverlay("")},getCaptions:function(){player.debug&&console.log("debug: getCaptions()"),playerHandler.getCaptionsTrigger&&clearTimeout(playerHandler.getCaptionsTrigger),(!playerHandler.getCaptionsFlag&&playerHandler.timeSpan.end<=myPlayer.currentMediaTime()||!playerHandler.getCaptionsFlag&&playerHandler.timeSpan.start>myPlayer.currentMediaTime())&&(playerHandler.getCaptionsFlag=!0,$.get("/getcaption?contentId="+player.liveEvent.id).then(function(e){if(e&&e&&e.length>0){playerHandler.refreshDelay=500,e.sort(playerHandler.sortCaptions),playerHandler.timeSpan.start=moment.duration(e[0].start).asSeconds()-4,playerHandler.timeSpan.end=moment.duration(e[e.length-1].end).asSeconds()-5;for(var t=0;t<e.length;t++){var r={};(r=e[t]).start=moment.duration(r.start).asSeconds()-4,r.end=moment.duration(r.end).asSeconds()-4,r.shown=!1,playerHandler.addCaption(r)}playerHandler.pollCaptions()}else playerHandler.refreshDelay<3e4&&(playerHandler.refreshDelay=2*playerHandler.refreshDelay)}).always(function(){playerHandler.getCaptionsFlag=!1})),playerHandler.getCaptionsTrigger=setTimeout(playerHandler.getCaptions,playerHandler.refreshDelay)},addAMPeventListeners:function(){function e(e){var t=0,r=20;e&&(t=125,r=150,document.getElementsByClassName("vjs-live-display")[0].onclick=function(){liveLabelClicked=!0});var n=myPlayer.duration()-myPlayer.currentAbsoluteTime(),a=document.getElementsByClassName("vjs-live-display")[0].childNodes[1];a.textContent=n>=t&&n<=r?"LIVE":"GO LIVE"}function t(){myPlayer.currentMediaTime&&myPlayer.currentTime(myPlayer.duration()-130)}player.debug&&console.log("debug: addAMPeventListeners"),myPlayer.addEventListener("timeupdate",function(r){eventService.isLive&&(eventService.event.liveCaption?(playerHandler.pollCaptions(),liveLabelClicked&&(t(),liveLabelClicked=!1),e(!0)):e(!1))}),myPlayer.addEventListener("sourceset",function(){eventService.isLive&&eventService.event.liveCaption&&(firstPlay=!0,playerHandler.getCaptions(),display.createCaptionsSettings())}),myPlayer.addEventListener("ended",function(){eventService.isChannel?playerHandler.startChannelProcess():(playerHandler.completed(),("Edge"==eventService.userAgent.browser.name||"IE"==eventService.userAgent.browser.name&&eventService.userAgent.browser.version>=11)&&myPlayer.isFullscreen()&&playerHandler.fullscreen(),playerHandler.getCaptionsTrigger&&clearTimeout(playerHandler.getCaptionsTrigger),playerHandler.pollCaptionsInterval&&clearTimeout(playerHandler.pollCaptionsInterval))}),myPlayer.addEventListener("play",function(){playerHandler.play(),playerHandler.startStatistics()}),myPlayer.addEventListener("pause",function(){playerHandler.pause()}),myPlayer.addEventListener("waiting",function(){playerHandler.buffering()}),myPlayer.addEventListener("volumechange",function(e){playerHandler.saveVolume(e)}),myPlayer.addEventListener("error",function(){playerHandler.playerError()}),myPlayer.addEventListener("loadeddata",function(){firstPlay&&t(),firstPlay=!1,playerHandler.setSound(),playerHandler.hideControlsForChannel(),playerHandler.hideControlsForiOS(),playerHandler.addCustomControls(),display.addPlayerEventTitle(),playerHandler.addHtmlEventListeners(),"vod"===player.eventType&&"Mobile"!==eventService.device.type&&playerHandler.checkForBookMarks(),playerHandler.setRightControlBarWidth()}),myPlayer.addEventListener("loadedmetadata",function(){}),myPlayer.addEventListener("playing",function(){if(!startedPlaying){if("iPhone"!==eventService.userAgent.device.model&&"iPad"!==eventService.userAgent.device.model&&"Safari"!==eventService.browser.name&&playerHandler.setQualityControlMenuBitrates(),"live"===player.eventType&&playerHandler.updateEvent(),playerHandler.startAccountBlock(),eventService.isChannel)if(extended&&null!==vodPosition)playerHandler.jumpToCurrentPosition(vodPosition);else if(!eventService.isLive){if(void 0===player.vodCurrentPosition&&player.currentShowing&&moment(player.currentShowing.start_time)<moment()){var e=moment(player.currentShowing.start_time),t=moment();player.vodCurrentPosition=t.diff(e,"seconds")}playerHandler.jumpToCurrentPosition(player.vodCurrentPosition)}startedPlaying=!0}})},startAccountBlock:function(){clearInterval(accountBlockInterval);var e=!1,t=!1;t=eventService.isChannel?player.hasChannelProduct:player.hasProduct,player.userToken&&t&&eventService.fetchAccountBlockConfig().then(function(t){(e=t.enable_account_block)?(playerHandler.checkAccountBlock(),accountBlockInterval=setInterval(playerHandler.checkAccountBlock,1e3*player.accountBlockPollTime)):clearInterval(accountBlockInterval)})},checkAccountBlock:function(){eventService.getAccountBlockInfo().then(function(e){e.account_blocked&&(clearInterval(accountBlockInterval),display.showError({message:errorMessages.accountBlockErrorMessage}))})},hideControlsForChannel:function(){eventService.isChannel&&(document.getElementsByClassName("vjs-progress-control vjs-control")[0].setAttribute("style","display: none !important"),document.getElementsByClassName("amp-controlbaricons-left")[0].setAttribute("style","display: none"),document.getElementsByClassName("vjs-current-time-display")[0].setAttribute("style","display: none"),document.getElementsByClassName("vjs-duration-display")[0].setAttribute("style","display: none"),document.getElementsByClassName("vjs-time-divider")[0].setAttribute("style","display: none"),document.getElementsByClassName("vjs-tech")[0].setAttribute("style","pointer-events:none"))},hideControlsForiOS:function(){"iPhone"!=eventService.userAgent.device.model&&"iPad"!=eventService.userAgent.device.model||(document.getElementsByClassName("vjs-volume-menu-button")[0].setAttribute("style","display: none"),document.getElementsByClassName("amp-quality-control")[0].setAttribute("style","display: none"),document.getElementsByClassName("vjs-fullscreen-control")[0].setAttribute("style","float: right"))},addCustomControls:function(){if(document.getElementsByClassName("vjs-captions-button")[0].setAttribute("style","display: none"),document.getElementsByClassName("reverse-control").length<=0){var e=document.getElementsByClassName("amp-controlbaricons-left")[0],t=document.createElement("div");t.className="reverse-control vjs-control vjs-button",t.setAttribute("role","button"),t.setAttribute("aria-live","polite"),t.setAttribute("tabindex","0"),t.setAttribute("onclick","playerHandler.reverseTenSeconds()"),t.setAttribute("onmouseenter","playerHandler.controlHover('reversControl')"),t.setAttribute("onmouseleave","playerHandler.controlNoLongerHover('reversControl')");var r=document.createElement("div");r.className="vjs-control-content";var n=document.createElement("span");n.className="vjs-control-text",n.innerHTML="Rewind";var a=document.createElement("div");a.className="reverse-tooltip";var o=document.createElement("p");o.className="reverse-tooltip-text",o.innerHTML="Rewind",a.appendChild(o),r.appendChild(n),t.appendChild(r),t.appendChild(a),e.appendChild(t);var l=document.getElementsByClassName("vjs-fullscreen-control")[0],i=document.createElement("div");i.className="fullscreen-tooltip";var s=document.createElement("p");if(s.className="fullscreen-tooltip-text",s.innerHTML="Fullscreen",i.appendChild(s),l.appendChild(i),document.getElementById("vid1").firstChild.setAttribute("webkit-playsinline",""),eventService.isLive){"Safari"==eventService.browser.name&&document.getElementsByClassName("vjs-progress-control vjs-control")[0].setAttribute("style","display: none !important"),document.getElementsByClassName("vjs-current-time vjs-control")[0].setAttribute("style","display: none"),document.getElementsByClassName("vjs-time-divider")[0].setAttribute("style","display: none"),document.getElementsByClassName("vjs-duration  vjs-control")[0].setAttribute("style","display: none");var c=document.getElementsByClassName("vjs-live-control vjs-control");document.getElementsByClassName("amp-controlbaricons-left")[0].removeChild[1];if(document.getElementsByClassName("amp-controlbaricons-middle")[0].appendChild(c[0]),document.getElementsByClassName("vjs-live-display")[0].childNodes[1].textContent="",eventService.event.liveCaption){var d=document.getElementsByClassName("amp-controlbaricons-right")[0],p=document.createElement("div");p.className="live-caption-button vjs-control vjs-button",p.setAttribute("role","button"),p.setAttribute("aria-live","polite"),p.setAttribute("tabindex","0"),p.setAttribute("onclick","playerHandler.displayCaption()"),p.setAttribute("onmouseenter","playerHandler.controlHover('liveCaptionButton')"),p.setAttribute("onmouseleave","playerHandler.controlNoLongerHover('liveCaptionButton')");var u=document.createElement("div");u.className="vjs-control-content";var m=document.createElement("span");m.className="vjs-control-text",m.innerHTML="Live Caption";var y=document.createElement("div");y.className="live-caption-tooltip";var v=document.createElement("p");v.className="live-caption-tooltip-text",v.innerHTML="Live Caption",y.appendChild(v),u.appendChild(n),p.appendChild(u),p.appendChild(y),d.insertBefore(p,d.childNodes[0])}}else document.getElementsByClassName("amp-livetimeindicator")[0].setAttribute("style","display: none")}},addHtmlEventListeners:function(){player.debug&&console.log("debug: addHtmlEventListeners");var e=document.getElementsByClassName("vjs-play-control")[0];e.setAttribute("onmouseenter","playerHandler.controlHover('playPauseControl')"),e.setAttribute("onmouseleave","playerHandler.controlNoLongerHover('playPauseControl')");var t=document.getElementsByClassName("amp-quality-control")[0];t.setAttribute("onmouseenter","playerHandler.controlHover('qualityControl')"),t.setAttribute("onmouseleave","playerHandler.controlNoLongerHover('qualityControl')");var r=document.getElementsByClassName("vjs-volume-control")[0];r.setAttribute("onmouseenter","playerHandler.controlHover('volumeControl')"),r.setAttribute("onmouseleave","playerHandler.controlNoLongerHover('volumeControl')");var n=document.getElementsByClassName("vjs-fullscreen-control")[0];n.setAttribute("onmouseenter","playerHandler.controlHover('fullscreenControl')"),n.setAttribute("onmouseleave","playerHandler.controlNoLongerHover('fullscreenControl')"),n.setAttribute("onclick","playerHandler.fullscreenControlClick()"),"IE"==eventService.userAgent.browser.name&&eventService.userAgent.browser.version>10&&document.getElementById("vid1").firstChild.setAttribute("ondblclick","playerHandler.fullscreen()")},checkForBookMarks:function(){if(bookMarksArray=[],void 0!==player.vod.bookmarks){var e=player.vod.bookmarks;if(0!==Object.keys(e).length){$.each(e,function(e,t){var r={time:t.time,description:t.description};bookMarksArray.push(r)});for(var t=0;t<bookMarksArray.length;t++){var r=playerHandler.durationToSeconds(bookMarksArray[t].time);bookMarksArray[t].time=r}bookMarksArray.sort(function(e,t){return parseFloat(e.time)-parseFloat(t.time)});for(var n=0;n<bookMarksArray.length;n++){var a=playerHandler.secondsToDuration(bookMarksArray[n].time);bookMarksArray[n].time=a}playerHandler.addBookMarksControl()}}},durationToSeconds:function(e){var t=e.split(":");return 3600*parseInt(t[0])+60*parseInt(t[1])+1*parseInt(t[2])},secondsToDuration:function(e){if(null===e||void 0===e)return"00:00:00";var t=function(e){return e%1!=0?e.toString().split(".")[1].length:0}(e);t>3&&(t=3);var r=Math.floor(e/3600).toString();e%=3600;var n=Math.floor(e/60).toString(),a=e%60,o=a.toFixed(t);return 1==r.length&&(r="0"+r),1==n.length&&(n="0"+n),a<10&&(o="0"+o),r+":"+n+":"+o},setRightControlBarWidth:function(){bookMarksArray.length;var e=eventService.event.subtitles&&!$.isEmptyObject(eventService.event.subtitles),t="iPad"===eventService.userAgent.device.model,r=document.getElementsByClassName("amp-controlbaricons-right")[0];t&&(e?r.setAttribute("style","width: 108px;"):r.setAttribute("style","width: 70px;"))},addBookMarksControl:function(){this.setRightControlBarWidth();var e=document.getElementsByClassName("amp-controlbaricons-right")[0],t=document.createElement("div");t.className="bookmark-icon-control vjs-control vjs-button",t.setAttribute("role","button"),t.setAttribute("aria-live","polite"),t.setAttribute("tabindex","0"),t.setAttribute("onclick","playerHandler.openBookmarks()"),t.setAttribute("onmouseenter","playerHandler.controlHover('bookmarkControl')"),t.setAttribute("onmouseleave","playerHandler.controlNoLongerHover('bookmarkControl')");var r=document.createElement("div");r.className="vjs-control-content";var n=document.createElement("span");n.className="vjs-control-text",n.innerHTML="Bookmarks";var a=document.createElement("div");a.className="bookmark-icon-tooltip";var o=document.createElement("p");o.className="bookmark-icon-tooltip-text",o.innerHTML="Bookmarks",a.appendChild(o),r.appendChild(n),t.appendChild(r),t.appendChild(a),e.insertBefore(t,e.lastChild)},openBookmarks:function(){var e=document.getElementsByClassName("vjs-control-bar")[0],t=document.getElementById("vid1").firstChild;if(eventService.isBookMarksOpen){eventService.isBookMarksOpen=!1;var r=document.getElementById("MainContainer"),n=document.createElement("div");n.id="BookmarksData",n.className="scroll-pane",n.setAttribute("style","display: none;"),r.appendChild(n);var a=document.getElementsByClassName("bookmark-list-control")[0];t.removeChild(a)}else{eventService.isBookMarksOpen=!0;var o=document.createElement("div");o.className="bookmark-list-control",o.innerHTML="Bookmarks<br />";var l=document.getElementById("BookmarksData");l.setAttribute("style","display: block;");var i=document.createElement("ul");i.id="bookmarksList",i.className="bookmarks-list",l.appendChild(i);for(var s=0;s<bookMarksArray.length;s++){var c=bookMarksArray[s].time,d=bookMarksArray[s].description,p=i.appendChild(document.createElement("li"));p.className="bookmark-list-item";var u=document.createElement("p");u.className="bookmark-time",u.innerHTML=c;var m=document.createElement("p");m.className="bookmark-text",m.innerHTML=d,p.appendChild(u),p.appendChild(m),p.addEventListener("click",playerHandler.moveToCurrentPosition.bind(null,c))}o.appendChild(l),t.appendChild(o),t.appendChild(e),$(document).ready(function(){$("#BookmarksData").jScrollPane()})}},moveToCurrentPosition:function(e){var t=playerHandler.durationToSeconds(e);myPlayer.currentTime(t)},buffering:function(){playerHandler.state=playerState.buffering,player.debug&&console.log("debug: state: "+playerHandler.state),void 0!==bufferingInterval&&clearInterval(bufferingInterval),secondsInBuffering=0,bufferingInterval=setInterval(playerHandler.bufferingTimer,1e3)},bufferingTimer:function(){secondsInBuffering++},checkBuffering:function(){currentPlayPos=myPlayer.currentTime();var e=1/checkInterval;!bufferingDetected&&currentPlayPos<lastPlayPos+e&&!myPlayer.paused&&(console.log("buffering"),bufferingDetected=!0,secondsInBuffering=0,bufferingInterval=setInterval(playerHandler.bufferingTimer,1e3)),bufferingDetected&&currentPlayPos>lastPlayPos+e&&!myPlayer.paused&&(console.log("not buffering anymore"),bufferingDetected=!1,clearInterval(bufferingInterval)),lastPlayPos=currentPlayPos},completed:function(){void 0!==chromeInterval&&clearInterval(chromeInterval),void 0!==statisticsIntervalId&&clearInterval(statisticsIntervalId),void 0!==accountBlockInterval&&clearInterval(accountBlockInterval),void 0!==updateEventInterval&&clearInterval(updateEventInterval),display.hideAll(),eventService.isLive?(elBannerButton.style.display="none",display.showMessage("This broadcast has ended and will be available on demand shortly."),setTimeout(function(){document.location=(isSsl?"https://":"http://")+window.location.host+"/play/vod/"+player.holderToken+"/"+player.eventId+"?autoplay=false&isadminportal="+(1==player.isAdminPortal?player.isAdminPortal:utils.getQueryVariable("isadminportal")+"&liveendedredirect=true")},9e4),playerHandler.state=playerState.waitingForVodArchive):(elBackgroundImage.setAttribute("src",eventService.event.playerBackground),elBannerButton.setAttribute("src",player.replayIconPNG),elBannerButton.setAttribute("onclick","playerHandler.reloadPlayer()"),elBanner.visible(!0),playerHandler.state=playerState.showingBanner)},controlHover:function(e){var t=document.getElementById("vid1");-1==t.className.search("control-hovering")&&(t.className=t.className+" control-hovering"),"liveCaptionButton"==e&&(document.getElementsByClassName("live-caption-button vjs-control")[0].style="color: #21BAE8")},controlNoLongerHover:function(e){var t=document.getElementById("vid1");t.className=t.className.replace(" control-hovering",""),"liveCaptionButton"!=e||playerHandler.showCaption||(document.getElementsByClassName("live-caption-button vjs-control")[0].style="color: gray")},fullscreen:function(){myPlayer.isFullscreen()?myPlayer.exitFullscreen():myPlayer.enterFullscreen()},fullscreenControlClick:function(){var e={iframeId:"player_"+player.eventId,crossdomainRedirectMessage:"fullscreen"};window.parent&&"IE"===eventService.userAgent.browser.name&&eventService.userAgent.browser.version<=10&&window.parent.postMessage(JSON.stringify(e),"*")},jumpToCurrentPosition:function(e){myPlayer.currentTime(e)},playerInit:function(){if(player.debug&&console.log("debug: playerHandler.playerInit"),eventService.event.hasPassword){if(display.PasswordIsHidden())return display.displayPassword();player.password=elPassword.value}eventService.getPlayoutUrl().then(function(){elPasswordProtection.visible(!1),elBanner.visible(!1),elPlayer.visible(!0),display.addPlayerHTML(),playerHandler.setupAMP(),playerHandler.addAMPeventListeners(),playerHandler.setMediaSource(),"Chrome"===eventService.userAgent.browser.name&&(chromeInterval=setInterval(playerHandler.checkBuffering,checkInterval)),playerHandler.state=playerState.playing,player.debug&&console.log("debug: state: "+playerHandler.state)})},pause:function(){playerHandler.state=playerState.paused,player.debug&&console.log("debug: state: "+playerHandler.state),void 0!==statisticsIntervalId&&clearInterval(statisticsIntervalId),clearInterval(bufferingInterval)},play:function(){playerHandler.state=playerState.playing,player.debug&&console.log("debug: state: "+playerHandler.state),clearInterval(bufferingInterval)},playerError:function(){hexString=myPlayer.error().code.toString(16),hexString=hexString.substr(2);var e=parseInt(hexString,16);clearTimeout(timeOutStreamError),void 0!==statisticsIntervalId&&clearInterval(statisticsIntervalId),player.debug&&(myPlayer.error().code&&amp.errorCode.abortedErrStart?console.log("// MEDIA_ERR_ABORTED errors"):myPlayer.error().code&&amp.errorCode.networkErrStart?console.log("// MEDIA_ERR_NETWORK errors"):myPlayer.error().code&&amp.errorCode.decodeErrStart?console.log("// MEDIA_ERR_DECODE errors"):myPlayer.error().code&&amp.errorCode.srcErrStart?console.log("// MEDIA_ERR_SRC_NOT_SUPPORTED errors"):myPlayer.error().code&&amp.errorCode.encryptErrStart?console.log("// MEDIA_ERR_ENCRYPTED errors"):myPlayer.error().code&&amp.errorCode.srcPlayerMismatchStart?console.log("// SRC_PLAYER_MISMATCH errors"):myPlayer.error().code&&amp.errorCode.networkErrHttpUrlNotFound?(console.log("http 404 error"),console.log(myPlayer.error().code),console.log(amp.errorCode.networkErrHttpUrlNotFound)):console.log("// unknown errors")),274726915==myPlayer.error().code&&display.showError({message:errorMessages.flashMissingError}),e==amp.errorCode.networkErrHttpPreconditionFailed&&(display.showBlank(),playerHandler.retryEventFeedOn412(),elBanner.visible(!1),elError.visible(!1),elPlayer.visible(!0)),eventService.isChannel&&eventService.isLive&&(809500675==myPlayer.error().code?setTimeout(playerHandler.reloadChannelPlayer,5e3):807403520!=myPlayer.error().code&&809500672!=myPlayer.error().code||setTimeout(playerHandler.reloadChannelPlayer,1e4)),"live"===player.eventType&&"Started"===player.liveEvent.status&&myPlayer.error().code&&amp.errorCode.networkErrHttpUrlNotFound&&(hexString=myPlayer.error().code.toString(16),hexString=hexString.substr(2),errorCode=parseInt(hexString,16),errorCode!=amp.errorCode.networkErrHttpUrlNotFound&&errorCode!=amp.errorCode.srcErrUnknown&&1342177280!=myPlayer.error().code||(display.showError({message:errorMessages.noFeedError,imageUrl:player.warningBgJPG}),playerHandler.retryEventFeedOn404()))},retryEventFeedOn404:function(){utils.ajaxRequest({url:isSsl?eventService.event.videoUrl.replace("http://","https://"):eventService.event.videoUrl}).then(function(e){myPlayer.dispose(),elError.visible(!1),display.hidePlayerBanner(),playerHandler.playerInit()}).catch(function(e){setTimeout(playerHandler.retryEventFeedOn404,6e4)})},retryEventFeedOn412:function(){elError.visible(!1),player.debug&&console.log("debug: playerHandler.retryEventFeedOn412"),eventService.getPlayoutUrl().then(function(){playerHandler.setMediaSource(),"Chrome"===eventService.userAgent.browser.name&&(chromeInterval=setInterval(playerHandler.checkBuffering,checkInterval)),playerHandler.state=playerState.playing})},updateRefreshTime:function(){if(null!==player.nextShowing&&void 0!==player.nextShowing){var e=moment(player.nextShowing.start_time),t=moment(),r=e.diff(t,"seconds");r<30&&(errorRefreshTime=1e3*(r+1))}},reloadChannelPlayer:function(){clearTimeout(timeOutStreamError),myPlayer.dispose(),null!==player.currentShowing&&moment(player.currentShowing.end_time)>=moment()?playerHandler.playerInit():(player.currentShowing=null,playerHandler.startChannelProcess())},startChannelProcess:function(){void 0!==chromeInterval&&clearInterval(chromeInterval),void 0!==statisticsIntervalId&&clearInterval(statisticsIntervalId),myPlayer.dispose(),display.hidePlayerBanner(),display.hideTVGuide();var e=null,t=null,r=null;null!==player.nextShowing&&void 0!==player.nextShowing&&(e=moment(player.nextShowing.start_time),t=moment(player.nextShowing.end_time)),null!==player.currentShowing&&void 0!==player.currentShowing&&player.currentShowing.is_live&&player.currentShowing.extended?(r=moment(player.currentShowing.end_time))>e&&e<=moment()&&t>moment()?(extended=!0,startedPlaying=!1,player.currentShowing=player.nextShowing,console.log("Switched to current program when LE extended :"+player.currentShowing.name+"at "+moment().format()),vodPosition=r.diff(e,"seconds"),setTimeout(app.switchToNextProgram,1e3)):(player.currentShowing=null,app.updateChannelSchedule()):(player.currentShowing=null,e<=moment()&&t>moment()?(player.currentShowing=player.nextShowing,console.log("Switched to current program :"+player.currentShowing.name+"at "+moment().format()),setTimeout(app.switchToNextProgram,1e3)):app.updateChannelSchedule())},updateChannelPrograms:function(){eventService.channelRefreshTime<3e5?(player.currentShowing=null,$.each(player.upcomingChannelPrograms,function(e,t){var r=moment(t.start_time),n=moment(t.end_time);r<=moment()&&n>moment()&&(player.currentShowing=t,console.log("Current program found: "+player.currentShowing.name+" at "+moment().format()))}),eventService.channelRefreshTime=3e5):(console.log("Refreshing data from server"),eventService.getChannelData().then(function(e){player.upcomingChannelPrograms=e.upcomingChannelPrograms,player.authorizationKeys=e.authorizationKeys,$.each(player.upcomingChannelPrograms,function(e,t){var r=moment(t.start_time),n=moment(t.end_time);r<=moment()&&n>moment()&&(player.currentShowing=player.upcomingChannelPrograms[0])})})),setTimeout(app.updateDisplayOnTvGuide,1e3)},showChannelProgramsSchedule:function(){display.setChannelImage(),display.hidePlayerBanner(),display.displayUpcomingPrograms(),player.currentShowing=null},reverseTenSeconds:function(){myPlayer.currentTime(myPlayer.currentTime()-10)},setupAMP:function(){player.debug&&console.log("debug: setupAMP"),amp.options.flashSS.swf=player.flashSSswf,amp.options.flashSS.plugin=player.flashSSplugin,amp.options.silverlightSS.xap=player.silverlightSSxap;var e=playerHandler.playerOptions();eventService.event.useHive&&(e.plugins=playerHandler.playerPlugin()),myPlayer=amp("vid1",e)},getSubtitlesSrcList:function(){var e=function(e,t){this.src=e,this.srclang=t,this.label=utils.getLanguageFromCultureName(t),this.kind="subtitles"},t=[],r=eventService.event.subtitles;for(var n in r)r.hasOwnProperty(n)&&(r[n].cropped_file_uri?t.push(new e(r[n].cropped_file_uri,n)):t.push(new e(r[n].file_uri,n)));return t},setMediaSource:function(){player.debug&&console.log("debug: setMediaSource");var e=[{src:isSsl?eventService.event.videoUrl.replace("http://","https://"):eventService.event.videoUrl,type:"application/vnd.ms-sstr+xml",streamingFormats:"Safari"===eventService.browser.name?["HLS-V4","HLS-V3"]:["DASH","SMOOTH","HLS-V4","HLS-V3"]}];eventService.event.useHive&&(e[0].sdnList=[{sdnName:"hive",sdnUrl:isSsl?eventService.event.hiveServiceUrl.replace("http://","https://"):eventService.event.hiveServiceUrl}]),eventService.event.subtitles?myPlayer.src(e,this.getSubtitlesSrcList()):myPlayer.src(e)},startStatistics:function(){player.debug&&console.log("debug: playerHandler.startStatistics"),clearInterval(statisticsIntervalId);var e=0;"iPhone"===eventService.userAgent.device.model&&"iPad"===eventService.userAgent.device.model||(e=Math.round(myPlayer.currentDownloadBitrate()/1e3),utils.isInt(e)||(e=0));if(!protocol)switch(myPlayer.currentType()){case"video/mp4":protocol="MP4";break;case"application/vnd.ms-sstr+xml":protocol="Smooth";break;case"application/dash+xml":protocol="DASH";break;case"application/vnd.apple.mpegurl":protocol="HLS";break;default:protocol=myPlayer.currentType()}secondsInBuffering=moment().startOf("day").add("s",secondsInBuffering).format("HH:mm:ss:ms"),SetStatistics(player.playerId,e,0,secondsInBuffering,protocol),secondsInBuffering=0,statisticsIntervalId=setInterval(playerHandler.startStatistics,3e4)},updateEvent:function(){console.log("Update Live Event at "+moment().format()),void 0!==updateEventInterval&&clearInterval(updateEventInterval),eventService.getEvent(player.authorizationKey).then(function(){console.log("Live Event Status :"+player.liveEvent.status+"at "+moment().format()),"Finished"===player.liveEvent.status&&(console.log("Live event is finished at "+moment().format()),playerHandler.completed())}),updateEventInterval=setInterval(playerHandler.updateEvent,6e5)},saveVolume:function(e){for(var t,r=document.cookie.split("; "),n=0;n<r.length;n++){var a=r[n].split("=");"player"==a[0]&&(t="{"!==(t=decodeURIComponent(a[1])).charAt(0)?JSON.parse(t.slice(2)):JSON.parse(t))}var o=encodeURIComponent(JSON.stringify({id:t.id,volume:myPlayer.volume()})),l=new Date;l.setMonth(l.getMonth()+12),document.cookie="player="+o+"; expires="+l.toUTCString()+"; path=/"},setSound:function(){player.sound&&myPlayer.volume(player.volume)},setSmallCaptionFont:function(){document.getElementById("caption-text").style.fontSize="15px"},setMediumCaptionFont:function(){document.getElementById("caption-text").style.fontSize="20px"},setLargeCaptionFont:function(){document.getElementById("caption-text").style.fontSize="25px"},setQualityControlMenuBitrates:function(){for(var e=myPlayer.currentVideoStreamList().streams[0].tracks,t=document.getElementsByClassName("amp-quality-control")[0].childNodes[0].childNodes[0].childNodes,r=0;r<=e.length;r++)-1!==t[r].innerHTML.indexOf("Auto")&&-1!==t[r].innerHTML.indexOf("Quality")&&(t[r].innerHTML=e[e.length-r].height+"p ("+Math.round(e[e.length-r].bitrate/1e5)/10+"Mbps)")},reloadPlayer:function(){myPlayer.dispose(),playerHandler.playerInit()},playerPlugin:function(){return{hive:{debugLevel:"notice",hiveTechOrder:["HiveJava"],HiveJava:{onActiveSession:function(e){console.log("Active Hive Tech: "+e.tech)},onError:function(e){return!0}},HiveJS:{onActiveSession:function(e){console.log("Active Hive Tech: "+e.tech)},onError:function(e){return!0}},StatsJS:{onActiveSession:function(e){console.log("Active Hive Tech: "+e.tech)},onError:function(e){return!0}}}}},playerOptions:function(){return{techOrder:["azureHtml5JS","flashSS","silverlightSS","html5"],nativeControlsForTouch:!1,logo:{enabled:!1},autoplay:!0,controls:player.controls,muted:!player.sound,width:"100%",height:"100%",poster:window.location.protoco+"://"+window.location.hostname+"/deafultThumb.jpg",traceConfig:{maxLogLevel:player.ampLogLevel,TraceTargets:[{target:"console"}]}}}};$(document).on("keypress",function(e){99==e.which&&(document.getElementById("caption-settings").style=playerHandler.showingCaptionsSetting?"display: none;":"display: block;",playerHandler.showingCaptionsSetting=!playerHandler.showingCaptionsSetting),eventService.isChannel||32==e.which&&(playerHandler.state==playerState.paused?myPlayer.play():myPlayer.pause())});