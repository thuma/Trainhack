function EventService(){this.userAgent=(new UAParser).getResult(),this.isLive="live"===player.eventType,this.isChannel=!1,this.timeOffset=moment().diff(moment(player.serverTime)),this.event=null,this.channelRefreshTime=3e5,this.isBookMarksOpen=!1,this.platform={isMobile:void 0!==this.userAgent.device.type,isMac:"Mac OS"===this.userAgent.os.name,isLinux:"Linux"===this.userAgent.os.name},this.device={},this.device.name=this.userAgent.device.name,this.device.type=void 0!==this.userAgent.device.type?this.userAgent.device.type.ucfirst():this.userAgent.device.type,"Windows"==this.userAgent.os.name||"Mac OS"==this.userAgent.os.name||"Linux"==this.userAgent.os.name||"Chromium OS"==this.userAgent.os.name?this.device.type="Desktop":"Windows Phone"==this.userAgent.os.name?this.device.type="Mobile":"Android"!=this.userAgent.os.name||void 0!==this.device.type&&"Unknown"!=this.device.type||(this.device.type="Mobile"),this.browser={},this.browser.name="Mobile"===this.device.type&&this.userAgent.browser.name.indexOf("Mobile")<0?"Mobile "+this.userAgent.browser.name:this.userAgent.browser.name}function EventModel(){return{id:null,archived:null,description:null,playerBackground:null,players:{default:null,selected:null},time:{created:null,provisioned:null,start:null,end:null},status:null,subtitle:null,title:null,useHive:null,videoUrl:null,hasPassword:!1}}function removeFilterFromPlayoutUrl(e){var t=e.split("(");if(1===t.length)return e;var r=t[1].slice(0,t[1].length-1).split(",").filter(function(e){return e.indexOf("filter")<0});return r.length>0?t[0]+"("+r.join(",")+")":t[0]}EventService.prototype.getTimeUntilStart=function(){var e,t;return e=moment.utc().subtract("ms",this.timeOffset),null!==(t=this.event.time.start)?moment.duration(moment(t).utc()-e.utc()):null},EventService.prototype.getTimeUntilEnd=function(){var e,t;return e=moment.utc().subtract("ms",this.timeOffset-2e3),null!==(t=this.event.time.end)?moment.duration(moment(t).utc()-e.utc()):null},EventService.prototype.getCurrentStatus=function(){player.debug&&console.log("debug: eventService.getCurrentStatus");var e,t,r,n,a,i,s,l,o,u;if(null!==(e=this.getTimeUntilStart())&&(r=e.seconds(),a=e.minutes(),s=e.hours(),o=e.days()),null!==(t=this.getTimeUntilEnd())&&(n=t.seconds(),i=t.minutes(),l=t.hours(),u=t.days()),this.isLive)null!==this.event.time.start||this.event.cancelled?this.event.cancelled?this.event.status=eventStatusType.cancelled:this.event.status=o<=0&&s<=0&&a<=0&&r<=0?u>=0&&l>=0&&i>=0&&n>=0?eventStatusType.started:eventStatusType.completed:eventStatusType.notStarted:this.event.status=eventStatusType.notScheduled;else{this.event.status=eventStatusType.completed}return this.event.status},EventService.prototype.getHiveInstaller=function(){var e=this,t=player.securityResourceUrl+"/"+player.holderToken+"/holders/"+player.holderToken,r=Q.defer();return utils.ajaxRequest({url:"/getdata",dataType:returnType.jsonString,data:{method:"GET",requestUrl:t,returnType:returnType.jsonString,authKey:player.authorizationKey,cache:player.disableCache}}).then(function(t){var n,a,i;t.hive_meta_info&&(a=(n=JSON.parse(t.hive_meta_info)).installer_download_base_path,i=n.installer_target_envs[0]),e.event.installer=n?{basePath:a,targetEnv:i}:{basePath:"/",targetEnv:"production"},e.platform.isMac?e.event.installer.fileName="HiveInstaller.dmg":e.platform.isLinux?e.event.installer.fileName="HiveInstaller_x86_64.rpm":e.event.installer.fileName="hive_allusers_setup.exe",r.resolve()}).catch(function(t){"Cannot read property '0' of undefined"===t.message?(e.event.installer={basePath:"",targetEnv:""},r.resolve()):r.reject(t)}),r.promise},EventService.prototype.setEventData=function(){player.debug&&console.log("debug: eventService.setData");var e=new EventModel;this.isLive?(e.hasPassword=player.liveEvent.password_protection_enabled,e.id=player.liveEvent.id,e.holderId=player.liveEvent.holderId,e.title=player.liveEvent.name,e.subtitle=player.liveEvent.subtitle?player.liveEvent.subtitle:"",e.description=player.liveEvent.meta_data&&player.liveEvent.meta_data.description?player.liveEvent.meta_data.description.en:"",e.useHive=!1,e.isProtected=player.liveEvent.aes_encryption_enabled,e.archived=player.liveEvent.archived,e.cancelled="Cancelled"==player.liveEvent.status,e.isPublished=player.liveEvent.published,e.time={created:player.liveEvent.created_date,provisioned:player.liveEvent.provisioned_time,start:player.liveEvent.start_time,end:player.liveEvent.end_time},e.liveCaption=player.liveEvent.liveCaption,"iPhone"!=eventService.userAgent.device.model&&"iPad"!=eventService.userAgent.device.model||(e.time.start=moment(e.time.start).add(8,"seconds").format("YYYY-MM-DD HH:mm:ss")),e.playerBackground=null!==player.liveEvent.image_path?player.liveEvent.image_path:player.defaultBgJPG):(e.id=player.vod.id,e.title=player.vod.name,e.subtitle=player.vod.subtitle?player.vod.subtitle:"",e.subtitles=player.vod.subtitles?player.vod.subtitles:"",e.description=player.vod.meta_data&&player.vod.meta_data.description?player.vod.meta_data.description.en:"",e.isProtected=player.vod.aes_encryption_enabled,e.useHive=!1,null!==player.vod.image_path?e.playerBackground=player.vod.image_path:null!==player.vod.thumbnail_url?e.playerBackground=player.vod.thumbnail_url:e.playerBackground=player.defaultBgJPG,e.isPublished="Published"==player.vod.status,e.hasPassword=player.vod.password_protection_enabled),this.event=e},EventService.prototype.getEvent=function(e){var t=this,r="";r=this.isLive?player.liveEventsResourceUrl+"/"+player.holderToken+"/live-events/"+player.eventId:player.vodResourceUrl+"/"+player.holderToken+"/vods/"+player.eventId;var n=Q.defer();return utils.ajaxRequest({url:"/getdata",dataType:returnType.jsonString,data:{method:"GET",requestUrl:r,returnType:returnType.jsonString,authKey:e,cache:player.disableCache}}).then(function(e){var r=new EventModel;r.id=e.id,r.title=e.name,r.subtitle=e.subtitle?e.subtitle:"",r.description=e.meta_data&&e.meta_data.description?e.meta_data.description.en:"",r.useHive=!1,r.hasPassword=e.password_protection_enabled,r.status=e.status,r.holderId=e.holder_id,t.isLive?(player.liveEvent=e,r.isProtected=e.aes_encryption_enabled,r.isPublished=e.published,r.archived=e.archived,r.time={created:e.created_date,provisioned:e.provisioned_time,start:e.start_time,end:e.end_time},r.playerBackground=null!==e.image_path?e.image_path:player.defaultBgJPG,r.liveCaption=e.live_caption):(player.vod=e,0!==e.assets.length&&(r.isProtected=e.assets[0].aes_encryption_enabled),null!==e.image_path?r.playerBackground=e.image_path:null!==e.thumbnail_url?r.playerBackground=e.thumbnail_url:r.playerBackground=player.defaultBgJPG,r.isPublished="Published"==e.status,r.bookMarks=void 0!==e.assets[0]?e.assets[0].bookmarks:void 0,r.subtitles=e.assets[0]&&e.assets[0].subtitles&&!Object.keys(e.assets[0].subtitles).length?e.assets[0].subtitles:void 0),t.event=r,n.resolve()}).catch(function(e){n.reject(e)}),n.promise},EventService.prototype.getPlayoutUrl=function(){player.debug&&console.log("debug: eventService.getPlayoutUrl");var e=Q.defer(),t=this;if(t.isLive&&t.getCurrentStatus()===eventStatusType.completed)return e.resolve(),e.promise;var r=utils.getProtocol(t),n=utils.getRequestUrl(r),a=player.authorizationKey;return eventService.isChannel&&$.each(player.authorizationKeys,function(e,t){t.videoId===player.eventId&&(a=t)}),utils.ajaxRequest({url:"/getdata",dataType:t.event.useHive?returnType.jsonString:"",data:{method:"GET",requestUrl:n,returnType:t.event.useHive?returnType.jsonString:returnType.string,password:player.password,authKey:a,cache:player.disableCache,channelId:player.channelId,isAdmin:player.isAdminPortal}}).then(function(r){r?(t.event.useHive?(t.event.videoUrl=r.playout_url,t.event.hiveServiceUrl=r.hive_service_url):(player.noFilter?t.event.videoUrl=removeFilterFromPlayoutUrl(r):t.event.videoUrl=r,console.log("## videoUrl "+t.event.videoUrl)),e.resolve()):display.showError({log:"Failed to retrieve playout URL",message:errorMessages.videoNotAvailable})}).catch(function(e){player.debug&&console.log(e),e.passwordError?display.wrongPasswordAlarm():display.showError({message:e})}),e.promise},EventService.prototype.getChannelData=function(){var e=Q.defer(),t=1e4*moment(),r=1e4*moment().add(30,"days"),n=player.channelResourceUrl+"/"+player.holderToken+"/channels/"+player.channelId+"/programs?from_end_time="+t+"&to_end_time="+r;return utils.ajaxRequest({url:"/getChannelProgramsAuthKeys",data:{requestUrl:n,authKey:player.authorizationKey,cache:player.disableCache}}).then(function(t){player.upcomingChannelPrograms=t.upcomingChannelPrograms,void 0!==t&&null!==t?(player.upcomingChannelPrograms.length>1&&(player.nextShowing=player.upcomingChannelPrograms[1]),e.resolve(t)):e.resolve(t)}).catch(function(t){e.reject(t)}),e.promise},EventService.prototype.fetchAccountBlockConfig=function(){var e=Q.defer(),t=player.currentHolder;void 0===player.currentHolder&&(t=player.holderToken);var r=player.securityResourceUrl+"/"+player.holderToken+"/holders/"+t;return utils.ajaxRequest({url:"/getdata",dataType:returnType.jsonString,data:{method:"GET",requestUrl:r,returnType:returnType.jsonString,authKey:player.authorizationKey,cache:player.disableCache}}).then(function(t){e.resolve(t)}).catch(function(t){e.reject(t)}),e.promise},EventService.prototype.getAccountBlockInfo=function(){var e=Q.defer(),t=player.currentHolder,r=player.eventId;eventService.isChannel&&(r=player.channelId),void 0===player.currentHolder&&(t=player.holderToken);var n=player.deliveryResourceUrl+"/"+t+"/viewersessions/"+player.userId;return utils.ajaxRequest({method:"POST",url:n+"?ContentId="+r+"&SessionHash="+player.sessionHash+"&SessionId="+player.sessionId+"&Nonce="+player.nonce,dataType:returnType.jsonString}).then(function(t){e.resolve(t)}).catch(function(t){t&&e.reject(t)}),e.promise},EventService.prototype.useHive=!1;